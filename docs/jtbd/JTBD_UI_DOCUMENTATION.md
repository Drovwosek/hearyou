# 🎯 JTBD UI Documentation

## Обзор

Создан UI компонент для отображения JTBD (Jobs-to-be-Done) анализа в HearYou. Компонент интегрирован в существующий интерфейс транскрибации.

## 📋 Что добавлено

### 1. Чекбокс для включения JTBD анализа
- Расположен в секции опций рядом с "Определить спикеров"
- Текст: "🎯 JTBD анализ (Jobs-to-be-Done)"
- Передаёт параметр `jtbd_analysis` в API

### 2. Новая секция результатов JTBD
- Появляется справа от транскрипции (на больших экранах) или снизу (на мобильных)
- Автоматически показывается при наличии JTBD данных
- Адаптивный layout: 2 колонки на экранах >1200px, 1 колонка на меньших

## 🎨 Визуальный дизайн

### Структура компонента

```
┌─────────────────────────────────────┐
│ 🎯 JTBD Анализ    [📋 Скопировать] │
├─────────────────────────────────────┤
│                                     │
│ 🎯 Работы (Jobs)              [3]  │
│ ├─ • Текст работы 1    ███░ 85%    │
│ ├─ • Текст работы 2    ██░░ 65%    │
│ └─ • Текст работы 3    ████ 95%    │
│                                     │
│ 😖 Боли (Pains)               [2]  │
│ ├─ • Текст боли 1      ███░ 78%    │
│ └─ • Текст боли 2      ██░░ 60%    │
│                                     │
│ 🎁 Выгоды (Gains)             [4]  │
│ ...                                 │
└─────────────────────────────────────┘
```

### Цветовая схема категорий

| Категория | Иконка | Цвет акцента | Bullet |
|-----------|--------|--------------|--------|
| Jobs (Работы) | 🎯 | Синий (#2563eb) | • синий |
| Pains (Боли) | 😖 | Красный (#dc2626) | • красный |
| Gains (Выгоды) | 🎁 | Зелёный (#16a34a) | • зелёный |
| Context (Контекст) | 📍 | Жёлтый (#ca8a04) | • жёлтый |
| Triggers (Триггеры) | ⚡ | Фиолетовый (#9333ea) | • фиолетовый |

### Визуализация Confidence

Каждый элемент имеет индикатор уверенности:

```
Текст элемента
███░ 75%  ← прогресс-бар (60px) + процент
```

**Градации цвета:**
- ≥80% - зелёный (высокая уверенность)
- 50-79% - оранжевый (средняя уверенность)
- <50% - красный (низкая уверенность)

## 🔧 Технические детали

### Формат данных от API

Backend должен возвращать JSON в поле `jtbd`:

```json
{
  "result": "текст транскрипции...",
  "jtbd": {
    "jobs": [
      {"text": "Описание работы", "confidence": 0.85}
    ],
    "pains": [
      {"text": "Описание боли", "confidence": 0.72}
    ],
    "gains": [
      {"text": "Описание выгоды", "confidence": 0.91}
    ],
    "context": [
      {"text": "Контекст использования", "confidence": 0.68}
    ],
    "triggers": [
      {"text": "Триггер действия", "confidence": 0.79}
    ]
  }
}
```

### Интеграция с API

1. **Отправка запроса:**
```javascript
formData.append('jtbd_analysis', true);  // если чекбокс включен
```

2. **Получение результата:**
```javascript
// Из SSE stream:
if (data.status === 'completed') {
  showResult(data.result, filename, totalTime, speakerLabeling, jtbdAnalysis, taskId, data.jtbd);
}

// Или из /result/{taskId}:
const data = await response.json();
// data.jtbd содержит JTBD результаты
```

3. **Отображение:**
```javascript
function showJTBD(jtbdData) {
  // Автоматически рендерит все категории
  // Показывает только те, где есть данные
}
```

### JavaScript функции

#### `showJTBD(jtbdData)`
Основная функция рендеринга JTBD результатов.

**Параметры:**
- `jtbdData` - объект с полями jobs, pains, gains, context, triggers

**Особенности:**
- Показывает только категории с данными
- Пустые категории не отображаются
- Если нет данных вообще - показывает "пустое" состояние

#### `copyJTBD()`
Копирует JTBD результаты в текстовом формате.

**Формат вывода:**
```
🎯 JTBD АНАЛИЗ

🎯 Работы (Jobs)
────────────────────────────────────────
1. Описание работы [85%]
2. Другая работа [72%]

😖 Боли (Pains)
────────────────────────────────────────
1. Описание боли [91%]
...
```

### История загрузок

JTBD флаг сохраняется в localStorage:

```javascript
{
  taskId: "abc123",
  filename: "interview.mp3",
  timestamp: 1709107200000,
  speakerLabeling: true,
  jtbdAnalysis: true  // ← новое поле
}
```

При загрузке из истории:
- Иконка 🎯 показывается рядом с названием файла
- JTBD данные автоматически подгружаются из `/result/{taskId}`

## 📱 Адаптивность

### Desktop (≥1200px)
```
┌──────────────────┬──────────────────┐
│  Транскрипция    │   JTBD Анализ   │
│                  │                  │
│  [текст...]      │  [категории...]  │
│                  │                  │
└──────────────────┴──────────────────┘
```

### Tablet/Mobile (<1200px)
```
┌──────────────────────────────────────┐
│         Транскрипция                 │
│                                      │
│         [текст...]                   │
│                                      │
└──────────────────────────────────────┘
┌──────────────────────────────────────┐
│         JTBD Анализ                  │
│                                      │
│         [категории...]               │
│                                      │
└──────────────────────────────────────┘
```

### Mobile адаптации
- Заголовки категорий складываются вертикально на узких экранах
- Счётчик элементов переносится под название
- Все элементы остаются читаемыми

## 🎯 UX особенности

### Анимации
- Плавное появление категорий (fadeIn 0.4s)
- Плавное заполнение прогресс-баров (0.3s)
- Hover эффект на элементах (сдвиг вправо + смена фона)

### Взаимодействие
- Каждый элемент подсвечивается при наведении
- Кнопка "Скопировать" меняется на "✓ Скопировано!" на 2 секунды
- Категории визуально разделены градиентным фоном

### Пустые состояния
Если нет данных:
```
        🤔
Нет данных для отображения
```

## 🚀 Использование

### Для пользователей

1. Загрузите аудио файл
2. Включите чекбокс "🎯 JTBD анализ"
3. Нажмите "Загрузить и транскрибировать"
4. После завершения увидите транскрипцию + JTBD анализ
5. Можно скопировать JTBD в текстовом виде

### Для разработчиков

**Изменённые файлы:**
- `packages/stt-service/static/index.html` - основной UI

**Что НЕ нужно менять:**
- Backend код (это делает другой субагент)
- Стили полностью в одном файле
- Нет зависимостей от внешних библиотек

**Расширение:**

Добавить новую категорию JTBD:

```javascript
// В categories массиве добавить:
{
  key: 'barriers',           // ключ в JSON
  title: 'Барьеры',          // заголовок
  icon: '🚧',                // emoji иконка
  description: 'Препятствия' // подсказка
}
```

И в CSS добавить цвета:

```css
.jtbd-category-header.barriers { border-left-color: #8b5cf6; }
.jtbd-category.barriers .jtbd-item-bullet { background: #8b5cf6; }
```

## 📊 Пример финального вида

### С данными

```
┌─────────────────────────────────────────────┐
│ 🎯 JTBD Анализ         [📋 Скопировать]    │
├─────────────────────────────────────────────┤
│                                             │
│ ┌─────────────────────────────────────┐    │
│ │ 🎯  Работы (Jobs)            [3]    │    │
│ └─────────────────────────────────────┘    │
│                                             │
│  • Понять возможности электронного         │
│    журнала для управления учебным          │
│    процессом                               │
│    ████░ 85%                               │
│                                             │
│  • Оценить совместимость с текущей LMS     │
│    ███░░ 72%                               │
│                                             │
│  • Узнать опыт других вузов с СПРИНТ       │
│    ████ 91%                                │
│                                             │
│ ┌─────────────────────────────────────┐    │
│ │ 😖  Боли (Pains)             [2]    │    │
│ └─────────────────────────────────────┘    │
│                                             │
│  • Сложная интеграция с существующими      │
│    системами                               │
│    ███░ 78%                                │
│                                             │
│  • Неясны требования к внедрению           │
│    ██░░ 65%                                │
│                                             │
└─────────────────────────────────────────────┘
```

### Без данных

```
┌─────────────────────────────────────────────┐
│ 🎯 JTBD Анализ         [📋 Скопировать]    │
├─────────────────────────────────────────────┤
│                                             │
│                    🤔                       │
│                                             │
│        Нет данных для отображения          │
│                                             │
└─────────────────────────────────────────────┘
```

## ✅ Чеклист выполнения

- [x] Чекбокс для включения JTBD анализа
- [x] Секция для отображения результатов
- [x] 5 категорий с уникальными иконками и цветами
- [x] Визуализация confidence (прогресс-бар + процент)
- [x] Адаптивный дизайн (grid layout)
- [x] Минималистичный профессиональный стиль
- [x] Переиспользуемые функции (showJTBD, copyJTBD)
- [x] Интеграция с историей загрузок
- [x] Копирование в текстовом формате
- [x] Анимации и hover эффекты
- [x] Пустые состояния
- [x] Мобильная адаптация

## 🔄 Интеграция с Backend

**Ожидается от backend субагента:**

1. Принимать параметр `jtbd_analysis=true` в POST /transcribe
2. Возвращать поле `jtbd` в результате с структурой:
   ```json
   {
     "jobs": [{text: str, confidence: float}],
     "pains": [{text: str, confidence: float}],
     "gains": [{text: str, confidence: float}],
     "context": [{text: str, confidence: float}],
     "triggers": [{text: str, confidence: float}]
   }
   ```
3. Confidence должен быть от 0.0 до 1.0

**Frontend готов принимать данные из:**
- SSE stream: `data.jtbd` в событии completed
- REST API: `/result/{taskId}` возвращает `{text: ..., jtbd: ...}`

---

**Статус:** ✅ Frontend часть полностью готова
**Версия:** 2026-02-28-071200
**Автор:** JTBD Frontend Subagent
