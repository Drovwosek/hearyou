#!/usr/bin/env python3
"""
–¢–µ—Å—Ç JTBD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å mock-–¥–∞–Ω–Ω—ã–º–∏ (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ API –≤—ã–∑–æ–≤–∞)
"""

import sys
import os
import json

project_root = os.path.dirname(os.path.abspath(__file__))
sys.path.insert(0, project_root)

from core.text_cleaner import TranscriptionCleaner

# Mock JTBD —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–∫–∞–∫ –±—É–¥—Ç–æ –ø—Ä–∏—à–µ–ª –æ—Ç Claude)
MOCK_JTBD_RESULT = {
    "jobs": [
        {
            "text": "–ë—ã—Å—Ç—Ä–æ –≤—ã—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫–∏ –∏ –ø–æ–π—Ç–∏ –¥–∞–ª—å—à–µ, –Ω–µ —Ç—Ä–∞—Ç—è –≤—Ä–µ–º—è –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ",
            "quote": "–Ø —Ö–æ—á—É –ø—Ä–æ—Å—Ç–æ –±—ã—Å—Ç—Ä–æ –∑–∞–π—Ç–∏, –≤—ã—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫–∏ –∏ –ø–æ–π—Ç–∏ –¥–∞–ª—å—à–µ",
            "type": "functional",
            "confidence": "high"
        },
        {
            "text": "–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å—é —É—á–µ–Ω–∏–∫–æ–≤ –±–µ–∑ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º",
            "quote": "–∑–∞ –ø–µ—Ä–µ–º–µ–Ω—É –≤—Å—ë —Å–¥–µ–ª–∞—Ç—å –∏ –Ω–µ –∑–∞–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ —É—Ä–æ–∫–æ–≤",
            "type": "functional",
            "confidence": "high"
        }
    ],
    "pains": [
        {
            "text": "–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∑–∞–≤–∏—Å–∞–µ—Ç, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ —É—á–∏—Ç–µ–ª–µ–π",
            "quote": "—Å—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∑–∞–≤–∏—Å–∞–µ—Ç. –û—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ –≤—Å–µ —É—á–∏—Ç–µ–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø—ã—Ç–∞—é—Ç—Å—è –≤—ã—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫–∏",
            "severity": "critical",
            "confidence": "high"
        },
        {
            "text": "–ü–æ—Ç–µ—Ä—è –≤—Ä–µ–º–µ–Ω–∏ –∏–∑-–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É",
            "quote": "–ü—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∑–∞—Ö–æ–¥–∏—Ç—å, –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É",
            "severity": "high",
            "confidence": "high"
        },
        {
            "text": "–ù–µ–ª–æ–≤–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è –ø–µ—Ä–µ–¥ —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏ –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã",
            "quote": "–∂—É—Ä–Ω–∞–ª –∑–∞–≤–∏—Å –ø—Ä—è–º–æ –ø–µ—Ä–µ–¥ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º —Å–æ–±—Ä–∞–Ω–∏–µ–º... —ç—Ç–æ –±—ã–ª–æ –æ—á–µ–Ω—å –Ω–µ–ª–æ–≤–∫–æ –ø–µ—Ä–µ–¥ —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏",
            "severity": "critical",
            "confidence": "high"
        }
    ],
    "gains": [
        {
            "text": "–°—Ç–∞–±–∏–ª—å–Ω–∞—è –∏ –±—ã—Å—Ç—Ä–∞—è —Ä–∞–±–æ—Ç–∞ —Å–∏—Å—Ç–µ–º—ã",
            "quote": "–ì–ª–∞–≤–Ω–æ–µ - —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ –±—ã—Å—Ç—Ä–æ",
            "type": "required",
            "confidence": "high"
        },
        {
            "text": "–ò–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∫–∞–∫ –≤ –æ–±—ã—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö",
            "quote": "–Ω–µ –Ω—É–∂–Ω–æ –±—ã–ª–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –¥—É–º–∞—Ç—å, –∫—É–¥–∞ –Ω–∞–∂–∞—Ç—å... –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∫–∞–∫ –≤ –æ–±—ã—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ",
            "type": "expected",
            "confidence": "high"
        },
        {
            "text": "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –∑–∞–±—ã—Ç—ã—Ö –æ—Ü–µ–Ω–∫–∞—Ö",
            "quote": "–±—ã–ª–æ –±—ã –∑–¥–æ—Ä–æ–≤–æ, –µ—Å–ª–∏ –±—ã —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–ª–∞, –µ—Å–ª–∏ —è –∑–∞–±—ã–ª–∞ –≤—ã—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É",
            "type": "desired",
            "confidence": "medium"
        },
        {
            "text": "–ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤–Ω–µ —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞",
            "quote": "–æ—á–µ–Ω—å –≤–∞–∂–Ω–∞ –º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è... –æ—Ç–∫—Ä—ã—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω –∏ —Å—Ä–∞–∑—É –≤–∏–¥–µ—Ç—å –≤—Å—ë —á—Ç–æ –Ω—É–∂–Ω–æ",
            "type": "expected",
            "confidence": "high"
        }
    ],
    "context": [
        {
            "text": "–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ—Å–ª–µ —É—Ä–æ–∫–æ–≤ + –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –∏—Ç–æ–≥–∏",
            "quote": "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –ø–æ—Å–ª–µ —É—Ä–æ–∫–æ–≤, –ø–ª—é—Å –≤ –∫–æ–Ω—Ü–µ –Ω–µ–¥–µ–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–¥–≤–æ–¥–∏—Ç—å –∏—Ç–æ–≥–∏",
            "dimension": "when",
            "confidence": "high"
        },
        {
            "text": "–ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –≤ –∫–æ–Ω—Ü–µ —á–µ—Ç–≤–µ—Ä—Ç–∏ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏",
            "quote": "—Å–∞–º–æ–µ –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω–æ–µ –≤—Ä–µ–º—è - —ç—Ç–æ –∫–æ–Ω–µ—Ü —á–µ—Ç–≤–µ—Ä—Ç–∏, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –Ω–µ —Ç–æ–ª—å–∫–æ –æ—Ü–µ–Ω–∫–∏ –≤—ã—Å—Ç–∞–≤–∏—Ç—å, –Ω–æ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏",
            "dimension": "when",
            "confidence": "high"
        },
        {
            "text": "–ß–∞—Å—Ç–æ –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –≤–Ω–µ —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞",
            "quote": "—á–∞—Å—Ç–æ –±—ã–≤–∞–µ—Ç, —á—Ç–æ –Ω—É–∂–Ω–æ —Å—Ä–æ—á–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ-—Ç–æ –≤ –∂—É—Ä–Ω–∞–ª–µ, –∞ —è –Ω–µ –Ω–∞ —Ä–∞–±–æ—á–µ–º –º–µ—Å—Ç–µ",
            "dimension": "where",
            "confidence": "high"
        }
    ],
    "triggers": [
        {
            "text": "–ò–Ω—Ü–∏–¥–µ–Ω—Ç —Å –∑–∞–≤–∏—Å–∞–Ω–∏–µ–º —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ–¥ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º —Å–æ–±—Ä–∞–Ω–∏–µ–º",
            "quote": "–ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É —è –Ω–∞—á–∞–ª–∞ –¥—É–º–∞—Ç—å –ø–æ—Å–ª–µ —Ç–æ–≥–æ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ –∂—É—Ä–Ω–∞–ª –∑–∞–≤–∏—Å –ø—Ä—è–º–æ –ø–µ—Ä–µ–¥ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º —Å–æ–±—Ä–∞–Ω–∏–µ–º",
            "type": "problem",
            "confidence": "high"
        }
    ],
    "summary": "–£—á–∏—Ç–µ–ª—å —Å—Ç–∞–ª–∫–∏–≤–∞–µ—Ç—Å—è —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–≥–æ –∂—É—Ä–Ω–∞–ª–∞, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ—Ç–µ—Ä–µ –≤—Ä–µ–º–µ–Ω–∏ –∏ –Ω–µ–ª–æ–≤–∫–∏–º —Å–∏—Ç—É–∞—Ü–∏—è–º. –û—Å–Ω–æ–≤–Ω–∞—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å - —Å—Ç–∞–±–∏–ª—å–Ω–∞—è, –±—ã—Å—Ç—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∏ –º–æ–±–∏–ª—å–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º. –¢—Ä–∏–≥–≥–µ—Ä–æ–º –¥–ª—è –ø–æ–∏—Å–∫–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã —Å—Ç–∞–ª –∏–Ω—Ü–∏–¥–µ–Ω—Ç —Å –∑–∞–≤–∏—Å–∞–Ω–∏–µ–º –ø–µ—Ä–µ–¥ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º —Å–æ–±—Ä–∞–Ω–∏–µ–º.",
    "metadata": {
        "model": "mock",
        "total_elements": 13,
        "input_tokens": 0,
        "output_tokens": 0
    }
}

def test_integration():
    """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å mock JTBD —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º"""
    
    print("=" * 80)
    print("–¢–ï–°–¢ –ò–ù–¢–ï–ì–†–ê–¶–ò–ò JTBD (MOCK)")
    print("=" * 80)
    print()
    
    # 1. –¢–µ—Å—Ç text cleaner
    print("1Ô∏è‚É£ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ TextCleaner...")
    cleaner = TranscriptionCleaner()
    
    test_text = "–≠—ç—ç, –Ω—É –≤–æ—Ç, –∫–æ—Ä–æ—á–µ, —è —Ö–æ—Ç–µ–ª —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ –∏–∏—à–∫–∞ –∏ –∏—Å–ø—Ä–∏–Ω–≥ –¥–ª—è –µ–≥—ç."
    cleaned = cleaner.clean(test_text, remove_filler_words=True, fix_artifacts=True)
    
    print(f"   –î–æ:  {test_text}")
    print(f"   –ü–æ—Å–ª–µ: {cleaned}")
    print("   ‚úÖ TextCleaner —Ä–∞–±–æ—Ç–∞–µ—Ç")
    print()
    
    # 2. –°–∏–º—É–ª—è—Ü–∏—è JTBD –∞–Ω–∞–ª–∏–∑–∞
    print("2Ô∏è‚É£ –°–∏–º—É–ª—è—Ü–∏—è JTBD –∞–Ω–∞–ª–∏–∑–∞...")
    print(f"   Mock —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:")
    print(f"   - Jobs: {len(MOCK_JTBD_RESULT['jobs'])}")
    print(f"   - Pains: {len(MOCK_JTBD_RESULT['pains'])}")
    print(f"   - Gains: {len(MOCK_JTBD_RESULT['gains'])}")
    print(f"   - Context: {len(MOCK_JTBD_RESULT['context'])}")
    print(f"   - Triggers: {len(MOCK_JTBD_RESULT['triggers'])}")
    print("   ‚úÖ JTBD —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∞–ª–∏–¥–Ω–∞")
    print()
    
    # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    print("3Ô∏è‚É£ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏...")
    try:
        json_str = json.dumps(MOCK_JTBD_RESULT, ensure_ascii=False, indent=2)
        parsed_back = json.loads(json_str)
        assert parsed_back == MOCK_JTBD_RESULT
        print("   ‚úÖ JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç")
        print()
    except Exception as e:
        print(f"   ‚ùå –û—à–∏–±–∫–∞ JSON: {e}")
        return False
    
    # 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    output_file = '/root/.openclaw/workspace/hearyou/example_jtbd_output.json'
    with open(output_file, 'w', encoding='utf-8') as f:
        json.dump(MOCK_JTBD_RESULT, f, ensure_ascii=False, indent=2)
    print(f"4Ô∏è‚É£ –ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω: {output_file}")
    print()
    
    # 5. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    print("=" * 80)
    print("–ü–†–ò–ú–ï–† JTBD –†–ï–ó–£–õ–¨–¢–ê–¢–ê")
    print("=" * 80)
    print()
    
    print("üìù SUMMARY:")
    print(MOCK_JTBD_RESULT['summary'])
    print()
    
    print("üéØ JOBS TO BE DONE:")
    for i, job in enumerate(MOCK_JTBD_RESULT['jobs'], 1):
        print(f"  {i}. [{job['type']}] {job['text']}")
    print()
    
    print("üò£ TOP PAINS:")
    for i, pain in enumerate(MOCK_JTBD_RESULT['pains'][:2], 1):
        print(f"  {i}. [{pain['severity']}] {pain['text']}")
    print()
    
    print("‚ú® KEY GAINS:")
    for i, gain in enumerate(MOCK_JTBD_RESULT['gains'][:2], 1):
        print(f"  {i}. [{gain['type']}] {gain['text']}")
    print()
    
    print("=" * 80)
    print("‚úÖ –ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–ô –¢–ï–°–¢ –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–Å–ù")
    print("=" * 80)
    print()
    print("‚ö†Ô∏è  –ü–†–ò–ú–ï–ß–ê–ù–ò–ï:")
    print("    –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ JTBD –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–π ANTHROPIC_API_KEY")
    print("    –¢–µ–∫—É—â–∏–π –∫–ª—é—á –≤ .env –≤—ã–¥–∞—ë—Ç –æ—à–∏–±–∫—É 401 (invalid x-api-key)")
    print("    –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á –Ω–∞: https://console.anthropic.com/")
    print()
    
    return True

if __name__ == '__main__':
    success = test_integration()
    sys.exit(0 if success else 1)
