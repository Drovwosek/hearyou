#!/usr/bin/env python3
"""
–¢–µ—Å—Ç JTBD –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –∏–Ω—Ç–µ—Ä–≤—å—é —Å –∫–ª–∏–µ–Ω—Ç–æ–º –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
"""

import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É
project_root = os.path.dirname(os.path.abspath(__file__))
sys.path.insert(0, project_root)

from core.jtbd_analyzer import JTBDAnalyzer
import json

# –ü—Ä–∏–º–µ—Ä —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –∏–Ω—Ç–µ—Ä–≤—å—é —Å –∫–ª–∏–µ–Ω—Ç–æ–º (—É—á–∏—Ç–µ–ª—å/–∑–∞–≤—É—á)
SAMPLE_TRANSCRIPTION = """
–ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä: –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫–∞–∫ –≤—ã —Å–µ–π—á–∞—Å –≤–µ–¥—ë—Ç–µ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∂—É—Ä–Ω–∞–ª?

–ö–ª–∏–µ–Ω—Ç: –ù—É, —É –Ω–∞—Å —Å–µ–π—á–∞—Å —Å—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∑–∞–≤–∏—Å–∞–µ—Ç. –û—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ –≤—Å–µ —É—á–∏—Ç–µ–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø—ã—Ç–∞—é—Ç—Å—è –≤—ã—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫–∏ –≤ –∫–æ–Ω—Ü–µ —á–µ—Ç–≤–µ—Ä—Ç–∏. –ü—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∑–∞—Ö–æ–¥–∏—Ç—å, –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É. –≠—Ç–æ –æ—á–µ–Ω—å —Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—Å–µ–≥–¥–∞ –º–∞–ª–æ.

–Ø —Ö–æ—á—É –ø—Ä–æ—Å—Ç–æ –±—ã—Å—Ç—Ä–æ –∑–∞–π—Ç–∏, –≤—ã—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫–∏ –∏ –ø–æ–π—Ç–∏ –¥–∞–ª—å—à–µ. –ê –Ω–µ —Å–∏–¥–µ—Ç—å –∏ –∂–¥–∞—Ç—å, –ø–æ–∫–∞ —Å–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è. –ö–æ–≥–¥–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ, —è –º–æ–≥—É –∑–∞ –ø–µ—Ä–µ–º–µ–Ω—É –≤—Å—ë —Å–¥–µ–ª–∞—Ç—å –∏ –Ω–µ –∑–∞–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ —É—Ä–æ–∫–æ–≤.

–ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä: –ê –∫–∞–∫ —á–∞—Å—Ç–æ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å –æ—Ü–µ–Ω–∫–∏?

–ö–ª–∏–µ–Ω—Ç: –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –ø–æ—Å–ª–µ —É—Ä–æ–∫–æ–≤, –ø–ª—é—Å –≤ –∫–æ–Ω—Ü–µ –Ω–µ–¥–µ–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–¥–≤–æ–¥–∏—Ç—å –∏—Ç–æ–≥–∏. –ù–æ —Å–∞–º–æ–µ –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω–æ–µ –≤—Ä–µ–º—è - —ç—Ç–æ –∫–æ–Ω–µ—Ü —á–µ—Ç–≤–µ—Ä—Ç–∏, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –Ω–µ —Ç–æ–ª—å–∫–æ –æ—Ü–µ–Ω–∫–∏ –≤—ã—Å—Ç–∞–≤–∏—Ç—å, –Ω–æ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –Ω–∏–º –Ω–∞–ø–∏—Å–∞—Ç—å –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π.

–ß–µ—Å—Ç–Ω–æ –≥–æ–≤–æ—Ä—è, –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É —è –Ω–∞—á–∞–ª–∞ –¥—É–º–∞—Ç—å –ø–æ—Å–ª–µ —Ç–æ–≥–æ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ –∂—É—Ä–Ω–∞–ª –∑–∞–≤–∏—Å –ø—Ä—è–º–æ –ø–µ—Ä–µ–¥ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º —Å–æ–±—Ä–∞–Ω–∏–µ–º. –ú–Ω–µ –Ω—É–∂–Ω–æ –±—ã–ª–æ –ø–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å –∫–ª–∞—Å—Å–∞, –∞ —è –Ω–µ –º–æ–≥–ª–∞ –¥–∞–∂–µ –∑–∞–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É. –≠—Ç–æ –±—ã–ª–æ –æ—á–µ–Ω—å –Ω–µ–ª–æ–≤–∫–æ –ø–µ—Ä–µ–¥ —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏.

–ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä: –ê —á—Ç–æ –¥–ª—è –≤–∞—Å —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ –≤ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–º –∂—É—Ä–Ω–∞–ª–µ?

–ö–ª–∏–µ–Ω—Ç: –ì–ª–∞–≤–Ω–æ–µ - —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ –±—ã—Å—Ç—Ä–æ. –ò —á—Ç–æ–±—ã –Ω–µ –Ω—É–∂–Ω–æ –±—ã–ª–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –¥—É–º–∞—Ç—å, –∫—É–¥–∞ –Ω–∞–∂–∞—Ç—å. –•–æ—á–µ—Ç—Å—è –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∫–∞–∫ –≤ –æ–±—ã—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ. –ï—â—ë –±—ã–ª–æ –±—ã –∑–¥–æ—Ä–æ–≤–æ, –µ—Å–ª–∏ –±—ã —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–ª–∞, –µ—Å–ª–∏ —è –∑–∞–±—ã–ª–∞ –≤—ã—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É –∫–æ–º—É-—Ç–æ –∏–∑ —É—á–µ–Ω–∏–∫–æ–≤.

–ò –æ—á–µ–Ω—å –≤–∞–∂–Ω–∞ –º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è - —á–∞—Å—Ç–æ –±—ã–≤–∞–µ—Ç, —á—Ç–æ –Ω—É–∂–Ω–æ —Å—Ä–æ—á–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ-—Ç–æ –≤ –∂—É—Ä–Ω–∞–ª–µ, –∞ —è –Ω–µ –Ω–∞ —Ä–∞–±–æ—á–µ–º –º–µ—Å—Ç–µ. –•–æ—á—É –æ—Ç–∫—Ä—ã—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω –∏ —Å—Ä–∞–∑—É –≤–∏–¥–µ—Ç—å –≤—Å—ë —á—Ç–æ –Ω—É–∂–Ω–æ.
"""

def test_jtbd_analyzer():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JTBD –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞"""
    
    print("=" * 80)
    print("–¢–ï–°–¢ JTBD –ê–ù–ê–õ–ò–ó–ê–¢–û–†–ê")
    print("=" * 80)
    print()
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
    print("üìä –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è JTBDAnalyzer...")
    analyzer = JTBDAnalyzer()
    print("‚úÖ –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
    print()
    
    # –ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
    print("üîç –ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏...")
    print(f"–î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞: {len(SAMPLE_TRANSCRIPTION)} —Å–∏–º–≤–æ–ª–æ–≤")
    print()
    
    try:
        result = analyzer.analyze(SAMPLE_TRANSCRIPTION)
        
        print("=" * 80)
        print("–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–ù–ê–õ–ò–ó–ê")
        print("=" * 80)
        print()
        
        # Summary
        if 'summary' in result:
            print("üìù SUMMARY:")
            print(result['summary'])
            print()
        
        # Jobs
        if 'jobs' in result and result['jobs']:
            print("üéØ JOBS TO BE DONE:")
            for i, job in enumerate(result['jobs'], 1):
                print(f"  {i}. [{job['type']}] [{job['confidence']}] {job['text']}")
                if job.get('quote'):
                    print(f"     üí¨ \"{job['quote'][:80]}...\"")
            print()
        
        # Pains
        if 'pains' in result and result['pains']:
            print("üò£ PAINS:")
            for i, pain in enumerate(result['pains'], 1):
                print(f"  {i}. [{pain['severity']}] [{pain['confidence']}] {pain['text']}")
                if pain.get('quote'):
                    print(f"     üí¨ \"{pain['quote'][:80]}...\"")
            print()
        
        # Gains
        if 'gains' in result and result['gains']:
            print("‚ú® GAINS:")
            for i, gain in enumerate(result['gains'], 1):
                print(f"  {i}. [{gain['type']}] [{gain['confidence']}] {gain['text']}")
                if gain.get('quote'):
                    print(f"     üí¨ \"{gain['quote'][:80]}...\"")
            print()
        
        # Context
        if 'context' in result and result['context']:
            print("üìç CONTEXT:")
            for i, ctx in enumerate(result['context'], 1):
                print(f"  {i}. [{ctx['dimension']}] [{ctx['confidence']}] {ctx['text']}")
                if ctx.get('quote'):
                    print(f"     üí¨ \"{ctx['quote'][:80]}...\"")
            print()
        
        # Triggers
        if 'triggers' in result and result['triggers']:
            print("‚ö° TRIGGERS:")
            for i, trigger in enumerate(result['triggers'], 1):
                print(f"  {i}. [{trigger['type']}] [{trigger['confidence']}] {trigger['text']}")
                if trigger.get('quote'):
                    print(f"     üí¨ \"{trigger['quote'][:80]}...\"")
            print()
        
        # Metadata
        if 'metadata' in result:
            print("üìà METADATA:")
            print(f"  Model: {result['metadata'].get('model', 'N/A')}")
            print(f"  Total elements: {result['metadata'].get('total_elements', 0)}")
            print(f"  Input tokens: {result['metadata'].get('input_tokens', 0)}")
            print(f"  Output tokens: {result['metadata'].get('output_tokens', 0)}")
            print()
        
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        output_file = '/root/.openclaw/workspace/hearyou/test_jtbd_result.json'
        with open(output_file, 'w', encoding='utf-8') as f:
            json.dump(result, f, ensure_ascii=False, indent=2)
        
        print(f"üíæ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω: {output_file}")
        print()
        print("=" * 80)
        print("‚úÖ –¢–ï–°–¢ –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–Å–ù")
        print("=" * 80)
        
    except Exception as e:
        print(f"‚ùå –û–®–ò–ë–ö–ê: {e}")
        import traceback
        traceback.print_exc()
        return False
    
    return True

if __name__ == '__main__':
    success = test_jtbd_analyzer()
    sys.exit(0 if success else 1)
