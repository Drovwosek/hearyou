# Тест-план для HearYou STT Service

## 1. UI / Базовый функционал

### 1.1 Загрузка страницы
- [ ] Страница загружается без ошибок (HTTP 200)
- [ ] Отображается заголовок "HearYou"
- [ ] Видна зона загрузки файлов
- [ ] Все элементы управления на месте
- [ ] Статистика отображается (0/0/0)

### 1.2 Начальное состояние
- [ ] Кнопка "Начать транскрибацию" отключена (disabled)
- [ ] Чекбоксы работают (можно включать/выключать)
- [ ] Дефолтные настройки: punctuation=ON, corrections=ON
- [ ] История пуста (показывает "История пуста")

## 2. Загрузка файлов

### 2.1 Выбор файла через клик
- [ ] Клик по зоне загрузки открывает диалог выбора файла
- [ ] После выбора файла отображается имя и размер
- [ ] Кнопка "Начать транскрибацию" становится активной
- [ ] Зона загрузки меняет стиль (has-file)

### 2.2 Drag & Drop
- [ ] При наведении файла появляется highlight
- [ ] После drop файл принимается
- [ ] Отображается информация о файле

### 2.3 Валидация размера
- [ ] Файл > 500 МБ отклоняется с понятной ошибкой
- [ ] Пустой файл (0 байт) отклоняется
- [ ] Нормальный файл (1-10 МБ) принимается

## 3. Валидация формата

### 3.1 Поддерживаемые форматы (должны работать)
- [ ] MP3 файл
- [ ] WAV файл
- [ ] AAC файл (с диктофона)
- [ ] M4A файл
- [ ] OGG файл
- [ ] MP4 видео (извлечение аудио)
- [ ] MKV видео

### 3.2 Неподдерживаемые форматы (должны отклоняться)
- [ ] TXT файл → ошибка "не является аудио или видео"
- [ ] PDF файл → ошибка с описанием
- [ ] JPG изображение → ошибка
- [ ] EXE файл → блокировка

### 3.3 Edge cases
- [ ] Файл без расширения → валидируется по содержимому
- [ ] Файл с неправильным расширением (.mp3 но на самом деле .txt) → отклоняется

## 4. Процесс транскрибации

### 4.1 Отправка запроса
- [ ] После клика "Начать транскрибацию" показывается прогресс
- [ ] Кнопка становится неактивной
- [ ] Появляется progress bar
- [ ] Отображается статус "Обработка..."

### 4.2 Обработка
- [ ] Progress обновляется (0% → 10% → ... → 100%)
- [ ] Сообщения меняются ("Конвертация...", "Транскрибация...", etc)
- [ ] Статистика обновляется (queued → processing)

### 4.3 Успешное завершение
- [ ] Progress bar исчезает
- [ ] Появляется результат транскрибации
- [ ] Текст можно скопировать
- [ ] Текст можно скачать (.txt)
- [ ] Статистика обновилась (completed +1)
- [ ] Задача появилась в истории со статусом "Готово"

### 4.4 Обработка ошибок
- [ ] Битый аудиофайл → понятная ошибка
- [ ] Файл без аудио → "не содержит аудио дорожки"
- [ ] Сетевая ошибка → "Failed to fetch" с подсказками
- [ ] Детали ошибки в консоли (F12)

## 5. Настройки транскрибации

### 5.1 Опции
- [ ] Punctuation ON → текст с пунктуацией
- [ ] Punctuation OFF → текст без знаков препинания
- [ ] Literature mode → убирает "эээ", "ммм"
- [ ] Clean → убирает слова-паразиты
- [ ] Corrections → применяет словарь исправлений

### 5.2 Комбинации
- [ ] Все опции OFF → сырой текст
- [ ] Все опции ON → максимальная обработка
- [ ] Только Literature → убираются звуки

## 6. История и статистика

### 6.1 История
- [ ] Каждая задача добавляется в историю
- [ ] Показывается имя файла (безопасное, экранированное)
- [ ] Показывается время создания
- [ ] Статус: Готово / Обработка / Ошибка
- [ ] История не обновляется без необходимости

### 6.2 Статистика
- [ ] "Всего задач" увеличивается
- [ ] "Завершено" обновляется после completion
- [ ] "В очереди" показывает текущую очередь
- [ ] Статистика обновляется только при активной обработке

## 7. Безопасность

### 7.1 Инъекции
- [ ] Имя файла с символами `<script>alert(1)</script>` → экранируется
- [ ] Имя с `../../../etc/passwd` → санитизируется
- [ ] Имя с null bytes → очищается
- [ ] Очень длинное имя (500+ символов) → обрезается

### 7.2 Rate Limiting
- [ ] 10 запросов подряд → работают
- [ ] 11-й запрос → HTTP 429 "Слишком много запросов"
- [ ] После минуты → снова работает

### 7.3 XSS защита
- [ ] HTML в имени файла не выполняется
- [ ] JavaScript в результате не выполняется
- [ ] Все пользовательские данные экранированы

## 8. Performance

### 8.1 Загрузка
- [ ] Страница загружается < 1 секунды
- [ ] Нет лишних запросов при idle
- [ ] Polling работает только во время обработки

### 8.2 Обработка
- [ ] Файл 1 МБ обрабатывается < 30 секунд
- [ ] Файл 10 МБ обрабатывается < 2 минут
- [ ] Параллельная обработка (3 воркера)

## 9. Mobile / Responsive

- [ ] Страница отображается на мобильном
- [ ] Drag & Drop на touch устройствах
- [ ] Кнопки доступны на маленьком экране

## 10. Логирование

### 10.1 Endpoint /logs
- [ ] GET /logs?lines=10 возвращает логи
- [ ] Логи содержат timestamps
- [ ] Логи содержат IP адреса
- [ ] Ошибки логируются с traceback

### 10.2 Консоль браузера
- [ ] Успешная загрузка логируется
- [ ] Ошибки отображаются с деталями
- [ ] Network requests видны в DevTools

## Критические сценарии (must pass)

1. **Happy Path**: MP3 файл 2 МБ → успешная транскрибация → текст можно скачать
2. **AAC с диктофона**: AAC файл → обрабатывается без ошибок
3. **Видео**: MP4 файл → извлекается аудио → транскрибация
4. **Безопасность**: Вредоносное имя файла → экранируется, не выполняется
5. **Rate limit**: 11 запросов → 11-й блокируется
6. **Ошибки**: Битый файл → понятная ошибка в UI

## Автоматизация

Этот план можно автоматизировать через:
- Browser automation (Playwright/Puppeteer)
- API тесты (pytest + requests)
- End-to-end тесты (Selenium)
