# HearYou STT Service

FastAPI –≤–µ–±-—Å–µ—Ä–≤–∏—Å –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ Yandex SpeechKit —Å –∫—Ä–∞—Å–∏–≤—ã–º –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üé® **–ö—Ä–∞—Å–∏–≤—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** —Å drag & drop
- üîÑ **–û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á** (–¥–æ 20 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- üìú **–ò—Å—Ç–æ—Ä–∏—è** –≤—Å–µ—Ö —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–π
- üßπ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** —Å–ª–æ–≤-–ø–∞—Ä–∞–∑–∏—Ç–æ–≤
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è** —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Å–ª–æ–≤
- üíæ **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ** —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- üìã **–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env.yandex`:

```bash
cp .env.example .env.yandex
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏ –¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ –∫—Ä–µ–¥–µ–Ω—à–µ–ª—ã
```

### 2. –ó–∞–ø—É—Å–∫ (Docker)

```bash
docker-compose up -d
```

–°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: **http://localhost:8000**

### 3. –ó–∞–ø—É—Å–∫ (–ª–æ–∫–∞–ª—å–Ω–æ)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫
python app.py
```

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000
2. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–ø—Ü–∏–∏ (—Ñ–∏–ª—å—Ç—Ä—ã, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
4. –ù–∞–∂–º–∏—Ç–µ "–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞—Ç—å"
5. –î–æ–∂–¥–∏—Ç–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
6. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ —Ç–µ–∫—Å—Ç

### API

#### –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è —Ñ–∞–π–ª–∞

```bash
curl -X POST http://localhost:8000/transcribe \
  -F "file=@audio.mp3" \
  -F "clean=true" \
  -F "literature=true"
```

–û—Ç–≤–µ—Ç:
```json
{
  "task_id": "abc123",
  "status": "queued"
}
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
curl http://localhost:8000/status/abc123
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```bash
curl http://localhost:8000/result/abc123
```

#### –°–∫–∞—á–∏–≤–∞–Ω–∏–µ TXT

```bash
curl -O http://localhost:8000/download/abc123
```

## ‚öôÔ∏è –û–ø—Ü–∏–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|-----|----------|--------------|
| `punctuation` | bool | –†–∞—Å—Å—Ç–∞–≤–ª—è—Ç—å –ø—É–Ω–∫—Ç—É–∞—Ü–∏—é | true |
| `literature` | bool | –£–±—Ä–∞—Ç—å "—ç—ç—ç", "–º–º–º" (Yandex API) | false |
| `clean` | bool | –£–±—Ä–∞—Ç—å —Å–ª–æ–≤–∞-–ø–∞—Ä–∞–∑–∏—Ç—ã | false |
| `corrections` | bool | –ü—Ä–∏–º–µ–Ω—è—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | true |
| `language` | string | –Ø–∑—ã–∫ (ru-RU, en-US) | ru-RU |

## üìä Endpoints

- `GET /` - –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- `POST /transcribe` - –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
- `GET /status/{task_id}` - –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
- `GET /result/{task_id}` - –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ (JSON)
- `GET /download/{task_id}` - –°–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç (TXT)
- `GET /history` - –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–π
- `GET /stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
- `DELETE /cleanup?days=7` - –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã
- `GET /docs` - Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üîí –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API —Å —Ç–æ–∫–µ–Ω–∞–º–∏, –¥–æ–±–∞–≤—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫:

```bash
curl -H "Authorization: Bearer YOUR_TOKEN" ...
```

–¢–æ–∫–µ–Ω—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ `app.py`:

```python
VALID_TOKENS = {
    "your_secret_token": "User Name",
}
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **3 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö worker** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á** –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è** –≤ OGG Opus
- **–°–∫–æ—Ä–æ—Å—Ç—å:** ~2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ —Ñ–∞–π–ª (7 —Å–µ–∫ –∞—É–¥–∏–æ)

## üßπ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞

```bash
# –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
curl -X DELETE http://localhost:8000/cleanup?days=7
```

–ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å cron:

```bash
0 2 * * * curl -X DELETE http://localhost:8000/cleanup?days=7
```

## üê≥ Docker –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫
docker-compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down

# –õ–æ–≥–∏
docker-compose logs -f

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose restart

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞
docker-compose build --no-cache
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
stt-service/
‚îú‚îÄ‚îÄ app.py                 # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îî‚îÄ‚îÄ index.html        # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ uploads/              # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ results/              # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (JSON)
‚îú‚îÄ‚îÄ temp/                 # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ .env.yandex          # –ö—Ä–µ–¥–µ–Ω—à–µ–ª—ã (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å!)
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ worker'–æ–≤

–í `app.py`:

```python
@app.on_event("startup")
async def startup_event():
    # 3 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    for _ in range(3):  # –ò–∑–º–µ–Ω–∏ –∑–¥–µ—Å—å
        asyncio.create_task(worker())
```

### –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

–í `app.py` –¥–æ–±–∞–≤—å:

```python
@app.on_event("startup")
async def cleanup_on_start():
    await cleanup_old_files(days=7)
```

## üí° –°–æ–≤–µ—Ç—ã

1. **–ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:** 3 worker'–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤ –æ—á–µ—Ä–µ–¥–∏
2. **–ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã:** –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –≤ OGG Opus (—Å–∂–∞—Ç–∏–µ)
3. **–ò—Å—Ç–æ—Ä–∏—è:** —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–±—Ä–æ—Å–∏—Ç
4. **–§–∞–π–ª—ã:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ N –¥–Ω–µ–π

## üêõ –û—Ç–ª–∞–¥–∫–∞

```bash
# –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker logs hearyou-stt -f

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
curl http://localhost:8000/stats

# Swagger UI
open http://localhost:8000/docs
```

## üìù TODO

- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤ –ë–î
- [ ] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –ö–≤–æ—Ç—ã –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- [ ] WebSocket –¥–ª—è real-time –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∏–¥–µ–æ (–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—É–¥–∏–æ)
- [ ] Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Ñ–∞–π–ª–æ–≤

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ**

*–ù–∞—Å—Ç—Ä–æ–µ–Ω–æ by Aquilla ü¶Ö*
